#:kivy 1.8.0
#:import splitext os.path.splitext
#:import basename os.path.basename

<ColorBox@Button>:
	background_normal: "atlas://data/images/defaulttheme/empty"
	background_down: "atlas://data/images/defaulttheme/empty"
	background_disabled: "atlas://data/images/defaulttheme/empty"

<IconButton@Button>:
	icon: None
    BoxLayout:
        pos: root.pos
        size: root.size
        orientation: 'horizontal'
        padding: 5
        spacing: 5
        Image:
            source: root.icon
            size_hint: (.4, 1.)
        Label:
            size_hint: (.6, 1.)
            text_size: self.size
            halign: 'left'
            valign: 'middle' 


<ReadyActionBar>:
	pos_hint: {'top':1}
	actview: actview

	ActionView:
		id: actview
		use_separator: True

		# The ActionBar doesn't work without an ActionPrevious: let's add an invisible one
		ActionPrevious:
			size_hint_x: None
			with_previous: False
			app_icon: "atlas://data/images/defaulttheme/transparent"
			width: 0

		ActionOverflow

<SettingColor>:
	rect: rect

	ColorBox:
		id: rect
		pos: root.pos

<SettingFont>:
	label: label

    Label:
    	id: label
        text: str(root.value)
        pos: root.pos
        font_size: '15sp'

<SettingSoundFont>:
    label: label

    Label:
        id: label
        text: basename(str(root.value))
        pos: root.pos
        font_size: '15sp'

<PluginsPanel>:
    spacing: 5
    padding: 5
    size_hint_y: None
    height: self.minimum_height
    plugins_box: plugins_box.__self__
    def_players_box: def_players_box.__self__
    def_lrc_box: def_lrc_box.__self__

    TabbedPanel:
        do_default_tab: False

        TabbedPanelItem:
            text: "Plug-ins"

            ActionBar:
                pos_hint: {'top':1}

                ActionView:
                    use_separator: True

                    ActionPrevious:
                        title: root.title
                        with_previous: False
                        app_icon: "atlas://data/images/defaulttheme/transparent"

                    ActionOverflow

                    ActionButton:
                        text: "Install"
                        on_release: root.install_plugin()

                    ActionButton:
                        text: "Download plugins"
                        disabled: True
                        on_release: root.download_plugin()

            ScrollView:
                size_hint: None, None
                do_scroll_x: False

                Scatter:
                    do_rotation: False
                    do_scale: False
                    do_translation: False
                    size_hint_y: None
                    height: plugins_box.height

                    BoxLayout:
                        id: plugins_box
                        size_hint_y: None
                        orientation: "vertical"

        TabbedPanelItem:
            text: "Default players"

            ActionBar:
                pos_hint: {'top':1}

                ActionView:
                    use_separator: True

                    ActionPrevious:
                        title: "Default players"
                        with_previous: False
                        app_icon: "atlas://data/images/defaulttheme/transparent"

                    ActionOverflow

                    ActionButton:
                        text: "Reset"
                        on_release: root.reset_default_players()

            ScrollView:
                size_hint: None, None
                do_scroll_x: False

                Scatter:
                    do_rotation: False
                    do_scale: False
                    do_translation: False
                    size_hint_y: None
                    height: def_players_box.height

                    BoxLayout:
                        id: def_players_box
                        size_hint_y: None
                        orientation: "vertical"

        TabbedPanelItem:
            text: "Default lyrics providers"

            ActionBar:
                pos_hint: {'top':1}

                ActionView:
                    use_separator: True

                    ActionPrevious:
                        title: "Default lyrics providers"
                        with_previous: False
                        app_icon: "atlas://data/images/defaulttheme/transparent"

                    ActionOverflow

                    ActionButton:
                        text: "Reset"
                        on_release: root.reset_default_lrc_providers()

            ScrollView:
                size_hint: None, None
                do_scroll_x: False

                Scatter:
                    do_rotation: False
                    do_scale: False
                    do_translation: False
                    size_hint_y: None
                    height: def_lrc_box.height

                    BoxLayout:
                        id: def_lrc_box
                        size_hint_y: None
                        orientation: "vertical"

<PluginItem>:
    size_hint: .25, None
    height: (labellayout.texture_size[1] if labellayout.texture_size[1] > 48 else 48) + dp(10)
    content: content
    title: self.manifest.title
    desc: self.manifest.short_description
    stock: self.manifest.stock

    canvas:
        Color:
            rgba: 47 / 255., 167 / 255., 212 / 255., self.selected_alpha
        Rectangle:
            pos: self.x, self.y + 1
            size: self.size
        Color:
            rgb: .2, .2, .2
        Rectangle:
            pos: self.x, self.y - 2
            size: self.width, 1

    AsyncImage:
        source: root.icon != "" and root.icon or "atlas://data/images/defaulttheme/image-missing"
        size_hint: None, None
        size: ("48dp", "48dp")

    BoxLayout:
        pos: root.pos

        Label:
            size_hint_x: .66
            id: labellayout
            markup: True
            text: u'{0}\n[size=13sp][color=999999]{1}[/color][/size]'.format(root.title or '', root.desc or '')
            font_size: '15sp'
            text_size: self.width - 32, None

        BoxLayout:
            id: content
            size_hint_x: .33


<CloseButton@ButtonBehavior+Image>
    popup: None
    source: 'atlas://data/images/defaulttheme/close'
    on_release: self.popup.dismiss()

<PluginPopup>:
    infolabel: infolabel

    GridLayout:
        padding: 12
        cols: 1
        size_hint: None, None
        pos: root.pos
        size: root.size

        CloseButton:
            popup: root
            x: root.x - (self.width / 2)
            y: root.y - (self.width / 2)

        BoxLayout:
            orientation: "horizontal"

            Label:
                text: root.manifest.title + " [i]" + root.manifest.version + "[/i]"
                markup: True
                color: root.title_color
                size_hint_y: None
                height: self.texture_size[1] + 16
                text_size: self.width - 16, None
                font_size: root.title_size

            Widget

            Switch:
                active: not root.plugin_disabled

        Widget:
            size_hint_y: None
            height: 4
            canvas:
                Color:
                    rgba: root.separator_color
                Rectangle:
                    pos: self.x, self.y + root.separator_height / 2.
                    size: self.width, root.separator_height

        GridLayout:
            cols: 2
            padding: dp(10)

            BoxLayout:
                orientation: "vertical"
                size_hint_x: None
                width: dp(128)

            ScrollView:
                size_hint: None, None
                do_scroll_x: False

                Scatter:
                    do_rotation: False
                    do_scale: False
                    do_translation: False
                    size_hint_y: None
                    height: infobox.height

                    BoxLayout:
                        id: infobox
                        size_hint_y: None
                        orientation: "vertical"

                        Label:
                            id: infolabel
                            markup: True

            


<FileChooserArtView>:
    on_entry_added: stacklayout.add_widget(args[1])
    on_entries_cleared: stacklayout.clear_widgets()
    scrollview: scrollview
    scrollbar: scrollbar

    ScrollView:
        id: scrollview
        pos: [root.pos[0], root.pos[1]]
        height: root.height
        width: root.width - 40
        size_hint: None, None
        do_scroll_x: False
        scroll_y: scrollbar.value
        bar_color: [0, 0, 0, 0]

        Scatter:
            do_rotation: False
            do_scale: False
            do_translation: False
            size_hint_y: None
            height: stacklayout.height
            StackLayout:
                id: stacklayout
                width: scrollview.width
                size_hint_y: None
                height: self.minimum_height
                spacing: '10dp'
                padding: '10dp'

    Slider:
    	x: root.width
    	y: root.y
    	size_hint: None, None
    	width: 40
    	height: root.height - 20
    	id: scrollbar
    	orientation: "vertical"
    	min: 0
    	max: 1
    	value: max(0, min(1, scrollview.scroll_y))

[FileThumbEntry@Widget]:
    locked: False
    path: ctx.path
    selected: self.path in ctx.controller().selection
    size_hint: None, None

    on_touch_down: self.collide_point(*args[1].pos) and ctx.controller().entry_touched(self, args[1])
    on_touch_up: self.collide_point(*args[1].pos) and ctx.controller().entry_released(self, args[1])
	size: '116dp', '116dp'

    canvas:
        Color:
            rgba: 1, 1, 1, 1 if self.selected else 0
        BorderImage:
            border: 8, 8, 8, 8
            pos: root.pos
            size: root.size
            source: 'atlas://data/images/defaulttheme/filechooser_selected'

    Image:
        size: '64dp', '64dp'
        source: ctx.controller().get_image(ctx)
        pos: root.x + dp(24), root.y + dp(40)
    Label:
        text: unicode(ctx.name, errors="replace")
        text_size: (root.width, self.height)
        halign: 'center'
        shorten: True
        size: '116dp', '16dp'
        pos: root.x, root.y + dp(16)

    Label:
        text: unicode(ctx.controller().gen_label(ctx), errors="replace")
        font_size: '11sp'
        color: .8, .8, .8, 1
        size: '116dp', '16sp'
        pos: root.pos
        halign: 'center'
